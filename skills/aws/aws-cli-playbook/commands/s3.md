# S3 CLI Reference

## Overview
Amazon Simple Storage Service (S3) provides object storage for data of any size. Use these commands to create and manage buckets, upload and download objects, manage versioning and lifecycle policies, set bucket policies and ACLs, and configure security features like encryption and logging.

## Discovery Commands (Read-Only)

```bash
# List all S3 buckets
aws s3 ls

# List buckets with more details
aws s3api list-buckets

# List objects in a bucket
aws s3 ls s3://my-bucket

# List objects with sizes and dates
aws s3 ls s3://my-bucket --human-readable --summarize

# List objects in a specific path (prefix)
aws s3 ls s3://my-bucket/path/to/objects/

# List objects recursively with details
aws s3 ls s3://my-bucket --recursive --human-readable

# Get bucket location
aws s3api get-bucket-location --bucket my-bucket

# Get bucket versioning status
aws s3api get-bucket-versioning --bucket my-bucket

# Get bucket lifecycle configuration
aws s3api get-bucket-lifecycle-configuration --bucket my-bucket

# Get bucket logging configuration
aws s3api get-bucket-logging --bucket my-bucket

# Get bucket encryption configuration
aws s3api get-bucket-encryption --bucket my-bucket

# Get bucket ACL
aws s3api get-bucket-acl --bucket my-bucket

# Get bucket policy
aws s3api get-bucket-policy --bucket my-bucket

# Get bucket CORS configuration
aws s3api get-bucket-cors --bucket my-bucket

# Get bucket website configuration
aws s3api get-bucket-website --bucket my-bucket

# Get bucket public access block settings
aws s3api get-public-access-block --bucket my-bucket

# Get object metadata
aws s3api head-object --bucket my-bucket --key path/to/object

# List object versions
aws s3api list-object-versions --bucket my-bucket

# Get object ACL
aws s3api get-object-acl --bucket my-bucket --key path/to/object

# List multipart uploads
aws s3api list-multipart-uploads --bucket my-bucket

# Get bucket metrics
aws s3api list-bucket-metrics-configurations --bucket my-bucket

# Check bucket replication configuration
aws s3api get-bucket-replication --bucket my-bucket
```

## Common Operations

```bash
# Create a new bucket
aws s3 mb s3://my-bucket

# Create bucket in specific region
aws s3api create-bucket \
  --bucket my-bucket \
  --region us-west-2 \
  --create-bucket-configuration LocationConstraint=us-west-2

# Upload a file
aws s3 cp myfile.txt s3://my-bucket/

# Upload file with specific key name
aws s3 cp myfile.txt s3://my-bucket/path/to/myfile.txt

# Upload file with metadata
aws s3api put-object \
  --bucket my-bucket \
  --key path/to/object \
  --body myfile.txt \
  --metadata "Department=Engineering,Version=1.0"

# Upload with server-side encryption
aws s3 cp myfile.txt s3://my-bucket/ --sse AES256

# Download a file
aws s3 cp s3://my-bucket/myfile.txt ./myfile.txt

# Sync directory to S3 (upload)
aws s3 sync ./local-dir s3://my-bucket/remote-dir

# Sync S3 to local directory (download)
aws s3 sync s3://my-bucket/remote-dir ./local-dir

# Sync with deletion (remove deleted local files from S3)
aws s3 sync ./local-dir s3://my-bucket/ --delete

# Sync excluding certain files
aws s3 sync ./local-dir s3://my-bucket/ --exclude "*.tmp"

# Enable versioning on bucket
aws s3api put-bucket-versioning \
  --bucket my-bucket \
  --versioning-configuration Status=Enabled

# Create lifecycle rule (delete old versions after 30 days)
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-bucket \
  --lifecycle-configuration file://lifecycle.json

# Enable encryption on bucket
aws s3api put-bucket-encryption \
  --bucket my-bucket \
  --server-side-encryption-configuration file://encryption.json

# Block public access on bucket
aws s3api put-public-access-block \
  --bucket my-bucket \
  --public-access-block-configuration \
  "BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"

# Enable MFA delete protection on bucket
aws s3api put-bucket-versioning \
  --bucket my-bucket \
  --versioning-configuration Status=Enabled,MFADelete=Enabled \
  --mfa "arn:aws:iam::123456789012:mfa/user 123456 789012"

# Set bucket logging
aws s3api put-bucket-logging \
  --bucket my-bucket \
  --bucket-logging-status file://logging.json

# Enable bucket inventory
aws s3api put-bucket-inventory-configuration \
  --bucket my-bucket \
  --id inventory-id \
  --inventory-configuration file://inventory.json

# Create bucket policy (allow public read)
aws s3api put-bucket-policy \
  --bucket my-bucket \
  --policy file://bucket-policy.json

# Set object ACL (private)
aws s3api put-object-acl \
  --bucket my-bucket \
  --key path/to/object \
  --acl private

# Add CORS configuration
aws s3api put-bucket-cors \
  --bucket my-bucket \
  --cors-configuration file://cors.json

# Create multipart upload
aws s3api create-multipart-upload \
  --bucket my-bucket \
  --key path/to/large-file

# List parts of multipart upload
aws s3api list-parts \
  --bucket my-bucket \
  --key path/to/large-file \
  --upload-id upload-id

# Copy object between buckets
aws s3 cp s3://source-bucket/object s3://dest-bucket/object

# Copy with ACL change
aws s3api copy-object \
  --copy-source source-bucket/object \
  --bucket dest-bucket \
  --key object \
  --acl public-read
```

## Mutation Commands (Require Approval)

```bash
# ⚠️ Delete an object
aws s3 rm s3://my-bucket/path/to/object

# ⚠️ Delete multiple objects matching pattern
aws s3 rm s3://my-bucket --recursive --exclude "*" --include "*.tmp"

# ⚠️ Delete all objects in bucket (recursive)
aws s3 rm s3://my-bucket --recursive

# ⚠️ Delete bucket (must be empty)
aws s3 rb s3://my-bucket

# ⚠️ Force delete bucket (requires removal of all versions and delete markers)
aws s3 rb s3://my-bucket --force

# ⚠️ Empty bucket of all objects
aws s3api delete-objects \
  --bucket my-bucket \
  --delete file://delete-list.json

# ⚠️ Delete object version
aws s3api delete-object \
  --bucket my-bucket \
  --key path/to/object \
  --version-id version-id

# ⚠️ Abort multipart upload
aws s3api abort-multipart-upload \
  --bucket my-bucket \
  --key path/to/large-file \
  --upload-id upload-id

# ⚠️ Delete bucket versioning (disables, doesn't remove old versions)
aws s3api put-bucket-versioning \
  --bucket my-bucket \
  --versioning-configuration Status=Suspended

# ⚠️ Remove bucket policy
aws s3api delete-bucket-policy --bucket my-bucket

# ⚠️ Remove bucket CORS configuration
aws s3api delete-bucket-cors --bucket my-bucket

# ⚠️ Remove bucket lifecycle configuration
aws s3api delete-bucket-lifecycle --bucket my-bucket

# ⚠️ Remove bucket logging configuration
aws s3api delete-bucket-logging --bucket my-bucket

# ⚠️ Disable bucket encryption
aws s3api delete-bucket-encryption --bucket my-bucket

# ⚠️ Remove public access block
aws s3api delete-public-access-block --bucket my-bucket

# ⚠️ Set object ACL to public-read (exposes object)
aws s3api put-object-acl \
  --bucket my-bucket \
  --key path/to/object \
  --acl public-read

# ⚠️ Remove object tagging
aws s3api delete-object-tagging \
  --bucket my-bucket \
  --key path/to/object
```

## Best Practices

- **Bucket Naming**: Use DNS-compliant names; buckets are global so names must be unique
- **Versioning**: Enable for production buckets to recover from accidental deletions
- **Encryption**: Enable default encryption (SSE-S3 or SSE-KMS) for all buckets
- **Public Access**: Block public access by default; use policies for intentional public sharing
- **Lifecycle Policies**: Transition old objects to Glacier for cost savings; delete non-essential data
- **Logging**: Enable access logging to another bucket for security auditing
- **MFA Delete**: Enable MFA delete protection for critical data to prevent accidental removal
- **Bucket Policies**: Prefer bucket policies over ACLs; use conditions for security (IP, VPC endpoint)
- **Object Tagging**: Tag objects for cost allocation, lifecycle management, and data classification
- **Cross-Region Replication**: Enable CRR for disaster recovery and compliance requirements
- **Sync Strategy**: Use --delete carefully; test with --dryrun first
- **Performance**: For high throughput, use key name prefixes to distribute across partitions

## Related Skills

- CloudFront - Cache S3 objects at edge locations
- IAM - Grant fine-grained S3 access through roles and policies
- Lambda - Process S3 objects with event triggers
- Data Lake - Build data lakes with S3 as storage layer
- Backup and Restore - Archive S3 data to Glacier for compliance
